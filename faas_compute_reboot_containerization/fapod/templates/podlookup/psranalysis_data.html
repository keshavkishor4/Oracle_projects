{% include "podlookup/header.html" %}
<body>
  {% load static %}
  <body>
      <style>
          #loader {
      position: fixed;
      left: 0px;
      top: 0px;
      width: 100%;
      height: 100%;
      z-index: 9999;
      background: url("{% static 'images/Spinner-3.gif' %}") 50% 50% no-repeat rgb(249,249,249);
  }
  .collapse:not(.show) {
    display: none;
}

.modal-dialog{
    position: relative;
    display: table; /* This is important */
    overflow-y: auto;
    overflow-x: auto;
    width: auto;
    min-width: 300px;
}
  </style>
  <style>
      * {
        box-sizing: border-box;
      }

      /* Create two equal columns that floats next to each other */
      .column1 {
        float: left;
        width: 50%;
        padding: 10px;
      }
      .column3 {
        float: left;
        width: 50%;
        padding: 10px;
      }
      /* Clear floats after the columns */
      .row:after {
        content: "";
        display: table;
        clear: both;
      }

      </style>
  <div id="loader"></div>
  <div class="container">
      <center>
          <div class="card" style="width: 25rem;">
              <div class="card-header">
                <h2>PSR Analysis</h2>
              </div>
              <div class="card-body">
                <form action="" method="GET">
                    <div class="input-group mb-3">
                        <label class="input-group-text" style="width: 50.1%;" for="items">PSR Report Type</label>
                        <select class="form-select" id="items" name="items">
                            <option value="item0">Select Option</option>
                            <option value="Manual">Manual</option>
                            <option value="Stamp">Stamp</option>
                        </select>
                    </div>
                    <div class="input-group mb-3">
                        <label class="input-group-text" style="width: 50.1%;">Choose Request</label>
                        <select class="form-select" id="size" name="size"></select>
                    </div>
                    <div class="input-group mb-3">
                        <label class="input-group-text" style="width: 50.1%;">Choose Date</label>
                        <select class="form-select" id="ChooseDate" name="ChooseDate"></select>
                    </div>
                    <div class="input-group mb-3">
                        <label class="input-group-text" style="width: 50.1%;">Region</label>
                        <select class="form-select" id="region" name="region"></select>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-secondary btn-lg" onclick="Reset_fn()">Submit</button>
                    </div>
                </form>
              </div>
          </div>
      </center>


      <center>

{% if data %}
 <h3> PSR Capacity <strong> {{ report }} </strong> Resizing Report for region <strong> {{ regin }} {{ r_type }} :{{ dat }} </strong> </h3>

<nav>
  <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
    <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Data</button>
    <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">DateWiseData</button>
  </div>
</nav>

<div class="tab-content" id="nav-tabContent">
  <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">

    <div class="row">
      <div class="column" style="flex:40%;padding:2px;">
        <div class="card" style="width: 23rem;">
            <div class="card-header" style="background:linear-gradient(45deg,rgb(6, 154, 11),black);" >
                <h2 style="color: white;text-align:center;">Current Usage</h2>
            </div>
            <div class="card-body">
            {% for key,data_it in data.items %}
            {% if key == 'current_uses' %}
            {% for obj,value in data_it.items %}
            <table class="table table-striped" summary="values">
                <thead>
                    <th colspan="2" style="text-align: center;">{{ obj }}</th>
                </thead>
                <tbody>
                  <table class="table">
                    <thead>
                      <tr>
                        <th>OCPUS</th>
                        <th>MEMORY</th>
                        <th>COUNT</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for li in value %}
                      <tr>
                        {% for i,j in li.items %}
                        <td> {{ j }}</td>
                        {% endfor %}
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </tbody>
            </table>
            {% endfor %}
            {% endif %}
            {% endfor %}
            </div>
        </div>

      </div>
      <div class="column" style="flex:20%;">
        <span style='font-size:100px;'>&#8680;</span>
      </div>
      <div class="column" style="flex:40%;padding:2px;">
        <div class="card" style="width: 23rem;">
            <div class="card-header" style="background:linear-gradient(45deg,blue,black);">
                <h2 style="color: white;text-align:center;">Capacity required </h2>
            </div>
            <div class="card-body">
            {% for key,data_it in data.items %}
            {% if key == 'capacity_require' %}
            {% for obj,value in data_it.items %}
            <table class="table table-striped" summary="values">
                <thead>
                    <th colspan="2" style="text-align: center;">{{ obj }}</th>
                </thead>
                <tbody>
                  <table class="table">
                    <thead>
                      <tr>
                        <th>OCPUS</th>
                        <th>MEMORY</th>
                        <th>COUNT</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for li in value %}
                      <tr>
                        {% for i,j in li.items %}
                        <td> {{ j }}</td>
                        {% endfor %}
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </tbody>
            </table>
            {% endfor %}
            {% endif %}
            {% endfor %}
            </div>
        </div>
      </div>
    </div>


    <hr>
    {% for key,values in data.items %}
      <div class="accordion accordion-flush" id="accordionFlushExample">
      {% for list in values %}
        {% for pods,data in list.items %}
          <div class="accordion-item">
            <h2 class="accordion-header" id="flush-headingOne{{pods}}">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne{{pods}}" aria-expanded="false" aria-controls="flush-collapseOne">
                {{ pods }}
              </button>
            </h2>
            <div id="flush-collapseOne{{pods}}" class="accordion-collapse collapse" aria-labelledby="flush-headingOne{{pods}}" data-bs-parent="#accordionFlushExample">
              <div class="accordion-body">

                <div class="row">
                  <div class="column">
                    <table class="table table-striped table-bordered text-center" summary="pod data">
                      <tbody>
                        <tr>
                          <td> Region : </td>
                          <td>{% for shape,shape_data in data.items %} {% if shape == "region" %} <strong> {{ shape_data }} </strong>{% endif %} {% endfor %}</td>
                        </tr>
                        <tr>
                          <td> TimeStamp : </td>
                          <td> {% for shape,shape_data in data.items %} {% if shape == "timestamp" %} <strong> {{ shape_data }}  </strong> {% endif %}{% endfor %} </td>
                        </tr>
                        <tr>
                            <td> Resize Type : </td>
                            <td> {% for shape,shape_data in data.items %} {% if shape == "Resize Type" %} <strong> {{ shape_data }}  </strong> {% endif %}{% endfor %} </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="column">
                    <table class="table table-striped table-bordered text-center" summary="pod data">
                      <tbody>
                        <tr>
                          <td> Resize Reason : </td>
                          <td> {% for shape,shape_data in data.items %} {% if shape == "Resize Reason" %} <strong> {{ shape_data }}  </strong> {% endif %}  {% endfor %}</td>
                        </tr>
                        <tr>
                          <td> Bugs : </td>
                          <td>{% for shape,shape_data in data.items %} {% if shape == "Bugs" %} <strong> {{ shape_data }}  </strong> {% endif %} {% endfor %} </td>
                        </tr>
                        <tr>
                          <td> POD Architecture : </td>
                          <td>{% for shape,shape_data in data.items %} {% if shape == "POD Architectur" %} <strong> {{ shape_data }}  </strong> {% endif %}{% endfor %} </td>
                        </tr>
                        <tr>
                          <td> Capacity details : </td>
                          <td>{% for shape,shape_data in data.items %} {% if shape == "region" %} <button type="button" onclick="capdetails('{{ pods }}','{{ shape_data }}')" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">{{ pods }} Capacity </button> {% endif %}{% endfor %}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  </div>

                <hr>
                <table summary="data">
                  <tr>
                    {% for shape,shape_data in data.items %}
                    <td>
                      {% if shape == "Old Shape" %}
                      <div class="card" style="width: 23rem;">
                          <div class="card-header" style="background:linear-gradient(45deg,rgb(6, 154, 11),black);" >
                              <center><h2 style="color: white;">Old Shape</h2></center>
                          </div>
                          <div class="card-body">
                          {% for obj,value in shape_data.items %}
                          {% if obj == 'vmtype' %}
                          {% for obj1,value1 in value.items %}
                          <table class="table table-striped" summary="data">
                              <thead>
                                  <th colspan="2" style="text-align: center;">{{ obj1 }}</th>
                              </thead>
                              <tbody>
                                  {% for i,j in value1.items %}
                                  <tr>
                                      <td>{{ i }} </td>
                                      <td>{{ j }}</td>
                                  </tr>
                                  {% endfor %}
                              </tbody>
                          </table>
                          {% endfor %}
                          {% else %}
                          <p> <strong> {{ obj }} : </strong> {{ value }} </p>
                          {% endif %}
                          {% endfor %}
                          </div>
                      </div>

                    </td>
                    <td>
                    <span style='font-size:100px;'>&#8680;</span>
                    {% endif %}
                    </td>
                <td>
                  {% if shape == "New Shape" %}
                  <div class="card" style="width: 23rem;">
                      <div class="card-header" style="background:linear-gradient(45deg,blue,black);" >
                          <center><h2 style="color: white;">New Shape</h2></center>
                      </div>
                      <div class="card-body">
                      {% for obj,value in shape_data.items %}
                      {% if obj == 'vmtype' %}
                      {% for obj1,value1 in value.items %}
                      <table class="table table-striped" summary="data">
                          <thead>
                              <th colspan="2" style="text-align: center;">{{ obj1 }}</th>
                          </thead>
                          <tbody>
                              {% for i,j in value1.items %}
                              <tr>
                                  <td>{{ i }} </td>
                                  <td>{{ j }}</td>
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                      {% endfor %}
                      {% else %}
                      <p> <strong> {{ obj }} : </strong> {{ value }} </p>
                      {% endif %}
                      {% endfor %}
                      </div>
                  </div>
                  {% endif %}
                </td>
                {% endfor %}
                </tr>
                </table>
              </div>
            </div>
          </div>
        {% endfor %}
      {% endfor %}
      </div>
    {% endfor %}

    {% else %}
    <h2> Error while fetching data </h2>
    {% endif %}
  </div>
  <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
    <div class="row">
      <div class="column" style="flex:40%;padding:2px;">
        <div class="card" style="width: 23rem;">
            <div class="card-header" style="background:linear-gradient(45deg,rgb(6, 154, 11),black);" >
                <h2 style="color: white;text-align:center;">Current Usage</h2>
            </div>
            <div class="card-body">
            {% for key,data_it in data.items %}
            {% if key == 'current_uses' %}
            {% for obj,value in data_it.items %}
            <table class="table table-striped" summary="values">
                <thead>
                    <th colspan="2" style="text-align: center;">{{ obj }}</th>
                </thead>
                <tbody>
                  <table class="table">
                    <thead>
                      <tr>
                        <th>OCPUS</th>
                        <th>MEMORY</th>
                        <th>COUNT</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for li in value %}
                      <tr>
                        {% for i,j in li.items %}
                        <td> {{ j }}</td>
                        {% endfor %}
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </tbody>
            </table>
            {% endfor %}
            {% endif %}
            {% endfor %}
            </div>
        </div>

      </div>
      <div class="column" style="flex:20%;">
        <span style='font-size:100px;'>&#8680;</span>
      </div>
      <div class="column" style="flex:40%;padding:2px;">
        <div class="card" style="width: 23rem;">
            <div class="card-header" style="background:linear-gradient(45deg,blue,black);">
                <h2 style="color: white;text-align:center;">Capacity required </h2>
            </div>
            <div class="card-body">
            {% for key,data_it in data.items %}
            {% if key == 'capacity_require' %}
            {% for obj,value in data_it.items %}
            <table class="table table-striped" summary="values">
                <thead>
                    <th colspan="2" style="text-align: center;">{{ obj }}</th>
                </thead>
                <tbody>
                  <table class="table">
                    <thead>
                      <tr>
                        <th>OCPUS</th>
                        <th>MEMORY</th>
                        <th>COUNT</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for li in value %}
                      <tr>
                        {% for i,j in li.items %}
                        <td> {{ j }}</td>
                        {% endfor %}
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </tbody>
            </table>
            {% endfor %}
            {% endif %}
            {% endfor %}
            </div>
        </div>
      </div>
    </div>

    
      <hr>
      {% for key,values in values_date.items %}
      {% if key != "capacity_require" and key != "current_uses" %}
            {% for i in values %}
              {% for pods,data in i.items %}
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="flush-headingOne{{pods}}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne{{pods}}" aria-expanded="false" aria-controls="flush-collapseOne">
                          {{ pods }}
                        </button>
                      </h2>
                      <div id="flush-collapseOne{{pods}}" class="accordion-collapse collapse" aria-labelledby="flush-headingOne{{pods}}" data-bs-parent="#accordionFlushExample">
                        <div class="accordion-body">
                          <div class="row">
                            <div class="column">
                              <table class="table table-striped table-bordered text-center" summary="pod data">
                                <tbody>
                                  <tr>
                                    <td> Region : </td>
                                    <td>{% for shape,shape_data in data.items %} {% if shape == "region" %} <strong> {{ shape_data }} </strong>{% endif %} {% endfor %}</td>
                                  </tr>
                                  <tr>
                                    <td> TimeStamp : </td>
                                    <td> {% for shape,shape_data in data.items %} {% if shape == "timestamp" %} <strong> {{ shape_data }}  </strong> {% endif %}{% endfor %} </td>
                                  </tr>
                                  <tr>
                                      <td> Resize Type : </td>
                                      <td> {% for shape,shape_data in data.items %} {% if shape == "Resize Type" %} <strong> {{ shape_data }}  </strong> {% endif %}{% endfor %} </td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                            <div class="column">
                              <table class="table table-striped table-bordered text-center" summary="pod data">
                                <tbody>
                                  <tr>
                                    <td> Resize Reason : </td>
                                    <td> {% for shape,shape_data in data.items %} {% if shape == "Resize Reason" %} <strong> {{ shape_data }}  </strong> {% endif %}  {% endfor %}</td>
                                  </tr>
                                  <tr>
                                    <td> Bugs : </td>
                                    <td>{% for shape,shape_data in data.items %} {% if shape == "Bugs" %} <strong> {{ shape_data }}  </strong> {% endif %} {% endfor %} </td>
                                  </tr>
                                  <tr>
                                    <td> POD Architecture : </td>
                                    <td>{% for shape,shape_data in data.items %} {% if shape == "POD Architectur" %} <strong> {{ shape_data }}  </strong> {% endif %}{% endfor %} </td>
                                  </tr>
                                  <tr>
                                    <td> Capacity details : </td>
                                    <td>{% for shape,shape_data in data.items %} {% if shape == "region" %} <button type="button" onclick="capdetails('{{ pods }}','{{ shape_data }}')" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">{{ pods }} Capacity </button> {% endif %}{% endfor %}</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                            </div>

                          <hr>
                          <table summary="data">
                            <tr>
                              {% for shape,shape_data in data.items %}
                              <td>
                                {% if shape == "Old Shape" %}
                                <div class="card" style="width: 23rem;">
                                    <div class="card-header" style="background:linear-gradient(45deg,rgb(6, 154, 11),black);" >
                                        <center><h2 style="color: white;">Old Shape</h2></center>
                                    </div>
                                    <div class="card-body">
                                    {% for obj,value in shape_data.items %}
                                    {% if obj == 'vmtype' %}
                                    {% for obj1,value1 in value.items %}
                                    <table class="table table-striped" summary="data">
                                        <thead>
                                            <th colspan="2" style="text-align: center;">{{ obj1 }}</th>
                                        </thead>
                                        <tbody>
                                            {% for i,j in value1.items %}
                                            <tr>
                                                <td>{{ i }} </td>
                                                <td>{{ j }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                    {% endfor %}
                                    {% else %}
                                    <p> <strong> {{ obj }} : </strong> {{ value }} </p>
                                    {% endif %}
                                    {% endfor %}
                                    </div>
                                </div>

                              </td>
                              <td>
                              <span style='font-size:100px;'>&#8680;</span>
                              {% endif %}
                              </td>
                          <td>
                            {% if shape == "New Shape" %}
                            <div class="card" style="width: 23rem;">
                                <div class="card-header" style="background:linear-gradient(45deg,blue,black);" >
                                    <center><h2 style="color: white;">New Shape</h2></center>
                                </div>
                                <div class="card-body">
                                {% for obj,value in shape_data.items %}
                                {% if obj == 'vmtype' %}
                                {% for obj1,value1 in value.items %}
                                <table class="table table-striped" summary="data">
                                    <thead>
                                        <th colspan="2" style="text-align: center;">{{ obj1 }}</th>
                                    </thead>
                                    <tbody>
                                        {% for i,j in value1.items %}
                                        <tr>
                                            <td>{{ i }} </td>
                                            <td>{{ j }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                                {% endfor %}
                                {% else %}
                                <p> <strong> {{ obj }} : </strong> {{ value }} </p>
                                {% endif %}
                                {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                          </td>
                          {% endfor %}
                          </tr>
                          </table>
                        </div>
                      </div>
                    </div>

              {% endfor %}
            {% endfor %}
      {% endif %}

      {% endfor %}
  </div>
</div>

        <!-- {% include "podlookup/psrdata.html" %} -->
</center>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Pod Capacity Details</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="d-flex justify-content-center">
          <div class="spinner-border loader-spin-off" id="loader-cap">
          </div>
        </div>
        <div id="capacity_data">

        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

</body>

<script type="text/javascript">

  var csrftoken = '{{ csrf_token }}'

$(document).ready(function () {
    $("#items").change(function () {
        var val = $(this).val();
        if (val == "Manual") {
            $("#size").html("<option value='FMDate'>FM Date</option>");
            var result="{{ m_fmdata | safe }}";
            var j = JSON.parse('{{ manual_reg_fmdata | safe }}');
            console.log(j)
            $("#ChooseDate").html(result);
          //  $("#region").html(reg);
        } else if (val == "Stamp") {
                $("#size").html("<option value='item0'>Select Option</option><option value='FMDate'>FM Date</option><option value='ReqDate'>Request Date</option>");
        }
    });
});

function Reset_fn() {
  document.getElementById("myForm").reset();
}

$(document).ready(function () {
    $("#size").change(function () {
        var val = $(this).val();
        var report= document.getElementById('items').value
        if (report == "Stamp"){
          if (val == "ReqDate"){
            var result = "{{ Req_stamp | safe }}";
            var reg="{{ reg_stamp | safe }}";
            $("#ChooseDate").html(result);
          }
          else if (val == "FMDate"){
            var result = "{{ s_fmdata | safe }}";
            var reg="{{ reg_stamp | safe }}";
            var j = JSON.parse('{{ stamp_reg_fmdata | safe }}');
            $("#ChooseDate").html(result);
            $("#region").html(reg);
          }
        }
    });
});

$(document).ready(function () {
    $("#ChooseDate").change(function () {
        var val = $(this).val();
        var report = document.getElementById('items').value
        var request = document.getElementById('size').value
        let text = "";
        if (report == "Manual") {
          var data = JSON.parse('{{ manual_reg_fmdata | safe }}');
          for (let i = 0; i < data[val].length; i++) {
            text=text+"<option value=\'"+data[val][i]+"\'>"+data[val][i]+"</option>"
            console.log(i)
            console.log(data[val][i])
          }
        }else if (report == "Stamp") {
          if (request == "ReqDate"){
            var data = JSON.parse('{{ stamp_reg_reqdata | safe }}');
            console.log(data)
            for (let i = 0; i < data[val].length; i++) {
              text=text+"<option value=\'"+data[val][i]+"\'>"+data[val][i]+"</option>"
              console.log(i)
              console.log(data[val][i])
            }

          }else if (request == "FMDate"){
            var data = JSON.parse('{{ stamp_reg_fmdata | safe }}');
            console.log(data)
            for (let i = 0; i < data[val].length; i++) {
              text=text+"<option value=\'"+data[val][i]+"\'>"+data[val][i]+"</option>"
              console.log(i)
              console.log(data[val][i])
            }
          }
        }
        $("#region").html(text);
    });
});

function capdetails(pod,region) {
    //console.log(region_name)
    try{
    let ajax = new XMLHttpRequest();
    var spin=document.getElementById("loader-cap");
    spin.classList.remove("loader-spin-off")
    spin.classList.add("loader-spin-on")
    ajax.onreadystatechange = function(){
    if (this.readyState === 4){
        if (this.status === 200){
          spin.classList.remove("loader-spin-on")
          spin.classList.add("loader-spin-off")
          console.log(this.responseText)
          document.getElementById("capacity_data").innerHTML = this.responseText;
          console.log(this.responseText)
        }
    }
}
ajax.open("POST", "{% url 'psrpagecapview' %}", true);
ajax.setRequestHeader("X-CSRFToken",csrftoken)
const data = new FormData()
data.append('podname',pod)
data.append('region',region)
ajax.send(data);
}
catch (e){
  console.log(e);
}
}

</script>
